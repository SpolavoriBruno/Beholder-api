#! /usr/bin/env node
const app = require('../src/app')
const appEM = require('../src/app-em')
const appWS = require('../src/app-ws')
const db = require('../src/db')
const logger = require('../utils/logger')
const { getDefaultSettings } = require('../src/repositories/settingsRepository')

const port = process.env.PORT || 3000

getDefaultSettings()
    .then(settings => {
        const server = app.listen(port, () => {
            logger.info(`Server is running on port ${port}`)
        })

        const wss = appWS(server)

        appEM(settings, wss)
    })
    .catch(error => logger.error(error))

