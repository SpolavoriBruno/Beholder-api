#! /usr/bin/env node

const beholder = require('../src/beholder')
const app = require('../src/app')
const appEM = require('../src/app-em')
const appWS = require('../src/app-ws')
const logger = require('../src/utils/logger')
const errorHandler = require('../src/utils/errorHandler')
const { getDefaultSettings } = require('../src/repositories/settingsRepository')

const port = process.env.PORT || 3000

getDefaultSettings()
    .then(settings => {
        const server = app.listen(port, () => {
            logger.info(`Server is running on port ${port}`)
        })

        beholder.init()
        const wss = appWS(server)

        appEM.init(settings, beholder, wss)
    })
    .catch(errorHandler)

